<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${recipeName}">Recipe Name</title>
</head>
<body>

<h1 th:text="${recipeName}">Recipe Name</h1>

<h2>Ingredients</h2>

<ul>
    <li th:each="ingredient : ${ingredients}">
        <span th:text="${ingredient.name}"></span>
        <span th:text="${ingredient.quantity}"></span>
        <span th:text="${ingredient.unit}"></span>
    </li>
</ul>

<!-- Display total weight of the recipe -->
<h3>Total Weight</h3>

<!-- Dropdown menu for unit selection -->
<select id="unitType" onchange="updateTotalWeight()">
    <option th:each="unit : ${T(com.michaelrkaplan.bakersassistant.models.UnitType).values()}"
            th:value="${unit.name}" th:text="${unit.name}" th:selected="${unit.name == 'grams'}">
    </option>
</select>

<!-- Display total weight based on the selected unit type -->
<p id="totalWeight" th:text="${totalWeight}"></p>

<script th:inline="javascript">
    // Function to update total weight based on the selected unit type
    function updateTotalWeight() {
        var unitType = document.getElementById("unitType").value;
        var totalWeight = parseFloat(document.getElementById("totalWeight").innerText);

        // Make an AJAX call to the server to fetch the converted total weight
        fetch('/recipes/convert-weight?unitType=' + unitType + '&weight=' + totalWeight)
            .then(response => response.json())
            .then(data => {
                document.getElementById("totalWeight").innerText = data.convertedWeight;
            });
    }
    // Initial call to set default total weight and unit type
    updateTotalWeight();
</script>


<h2>Instructions</h2>
    <p th:text="${instructions}">Instructions</p>

<!-- Link to delete the recipe -->
<a th:href="@{/recipes/{recipeName}/delete(recipeName=${recipeName})}" class="delete-link">Delete Recipe</a>

</body>
</html>
